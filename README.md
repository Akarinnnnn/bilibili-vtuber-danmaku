# bilibili-Vtuber-danmaku

Vtuber直播间的弹幕哟

### JSON

```javascript
const { rooms, records, roomsRecords, read } = require('./json')
// 以上全部都是async/Promise
```

#### rooms()

返回Array, 内容是房间列表

```javascript
rooms()
// [
//   "10143",
//   "10209381",
//   "102153",
//   ...
// ]
```

#### records(roomid)

* roomid: 房间号

返回Array, 内容是该房间所有记录的目录

```javascript
records(12235923)
// [
//   '2019-5-10', '2019-5-11',
//   '2019-5-12', '2019-5-13',
//   '2019-5-14', '2019-5-15',
//   ...
// ]
```

#### roomsRecords()

返回Object, 内容是所有房间以及房间目录, rooms+records

```javascript
roomsRecords(12235923)
// {
//   '10143': [
//     '2019-5-17',
//     '2019-5-20',
//     '2019-5-27',
//     '2019-5-29',
//     '2019-5-30',
//     '2019-5-31'
//   ],
//   '10317': [ '2019-5-31', '2019-6-1' ],
//   '14893': [
//     '2019-5-10', '2019-5-11',
//     '2019-5-12', '2019-5-13',
//     '2019-5-14', '2019-5-15',
//     ...
// }
```

#### read(roomid, date)

* roomid: 房间号
* date: 年-月-日

读取TXT并进行一些分析

```javascript
read(12235923, '2019-6-4')
// {
//   danmaku: [
//     { time: 0, mid: 14501198, text: '挤进去打哭她' },
//     { time: 0, mid: 9175795, text: '草，根本挤不进去' },
//     { time: 0, mid: 13586622, text: 'foooooooo' },
//     ...
//   ],
//   raw: ...
//   speakers: {
//     '2514': { speakerNum: 1, uname: 'lostsoul' },
//     '4955': { speakerNum: 55, uname: '纱布丁' },
//     '35712': { speakerNum: 8, uname: 'aLIE_w' },
//     ...
//   },
//   online: [
//     1, 1, 1,
//     1, 1, 1,
//     ...
//   ],
//   speakerNum: 140
// }
```

其中数据的意思:

* danmaku: Array, 文档中的所有弹幕
  * time: 单位分钟, 从今天0:0算起发送弹幕的时间
  * mid: 发送者mid
  * text: 弹幕文本
* speakers: Object, 发过弹幕的人, Key=mid
  * speakerNum: 发了几条弹幕
  * uname: 用户名
* online: Array, 长度为 1440, 记录每分钟的人气, 没开播时为1
* speakerNum: 总发言人数, 其实是 `Object.keys(speakers).length`
* raw: txt的文本

### Socket.io

https://api.vtbs.moe/vds

```javascript
const io = require('socket.io-client')
const socket = io('https://api.vtbs.moe/vds')
```

#### 订阅 (join)

```javascript
socket.emit('join', roomid) // 订阅特定房间
socket.emit('join', 'all')  // 订阅所有房间 
```

#### 取消订阅 (leave)

```javascript
socket.emit('leave', roomid) // 取消订阅特定房间
socket.emit('leave', 'all')  // 取消订阅所有房间 
```

注意：订阅了一部分房间之后取消订阅 `all` 并不会取消所有房间，只会取消之前订阅的 `all`。

#### 弹幕事件

```javascript
socket.on('danmaku', console.log)
// {message: "233", roomid: 12235923, mid: 3499295}
```

### Raw:TXT格式

#### 弹幕

纯文本，记录发送者信息

`[mid]:[text]`

#### 时间戳

`TIME[x:x]ONLINE[number]`

如 `TIME2:3ONLINE397`: 凌晨2:3, 人气397

#### 发送人数统计

每天结束时在文件结尾统计`SPEAKERNUM[x];[mid]:[uname]:[x], ...`

### 快捷链接:

* Project Paryi
  * 帕里\_Paryi: [4895312](4895312)
  * ユメノシオリ: [14052636](14052636)
  * 神楽めあOfficial: [12235923](12235923)
  * 千草はな: [12770821](12770821)
  * 森永みうofficial: [7962050](7962050)
  * 有栖マナOfficial: [3822389](3822389)
  * 高槻律official: [947447](947447)
  * 花園セレナOfficial: [14327465](14327465)
  * ENA에나: [6632844](6632844)
* Chukolala
  * 乙女おと搬运组: [21320551](21320551)
  * 來夢めると搬运组: [4078398](4078398)
  * 綴目日傘搬运组: [21320281](21320281)
  * 千鈴めい搬运组: [180784](180784)
  * 古守ちゆ: [8725120](8725120)
  * 暁ちあき搬运组: [262755](262755)
* Homolive
  * 犬山玉姬Official: [4634167](4634167)
* hololive: [8982686](8982686)
  * 时乃空Official: [8899503](8899503)
  * 萝卜子Official: [4664126](4664126)
  * 樱巫女Official: [21144047](21144047)
  * 夜空梅露Official: [21131813](21131813)
  * 亚绮-罗森Official: [21219990](21219990)
  * 赤井心Official: [14275133](14275133)
  * 白上吹雪Official: [11588230](11588230)
  * 夏色祭Official: [13946381](13946381)
  * 湊-阿库娅Official: [14917277](14917277)
  * 紫咲诗音Official: [21132965](21132965)
  * 百鬼绫目Official: [21130785](21130785)
  * 癒月巧可Official: [21107534](21107534)
  * 大空昴Official: [21129632](21129632)
  * 大神澪Official: [21133979](21133979)
* AIchannel搬运: [1485080](1485080)
* ENTUM
  * 未来明-MiraiAkari: [6792401](6792401)
  * 猫宫日向Official: [9286381](9286381)
  * もちひよこOfficial: [3657657](3657657)
* 🔨
  * Overidea\_China: [704808](704808)
* 虚拟女友Yomemi: [10363055](10363055)
* sora4
  * 白音小雪Official: [6241497](6241497)
* Winks
  * 陆婉莹GodRiku: [11575621](11575621)
  * 惺忪喵Xingsongmiao: [13990746](13990746)
  * 放飞鸽季毅: [13990730](13990730)
  * 虚拟杂草花音氏: [13973403](13973403)
  * 阿修アッシュ: [13982579](13982579)
  * 于川流丹真的太可爱了: [13993127](13993127)
    * 阿A生恰太阳鱼: [5193796](5193796)
    * 鸠子はとこ: [160683](160683)
  * 莉姬是女王: [15142311](15142311)
  * 爱夏なつ: [3889934](3889934)
  * 初颜大可爱: [15162482](15162482)
  * 奈子Nakooo: [15157903](15157903)
  * 音仙吕: [15096239](15096239)
* Winks Extra
  * 钟持\_虚拟说书狂战士: [16784](16784)
  * JK小亚: [13917541](13917541)
  * 鬼月Official: [5506769](5506769)
* KMNHZ
  * KMNHZ-China: [7688266](7688266)
* Office339
  * 虚拟DD: [7934153](7934153)
  * JJ-Official: [14650485](14650485)
  * 虚拟宫宫Official: [1676221](1676221)
* Unlimited
  * 游戏部企划official: [6586670](6586670)
* 2434
  * 椎名唯华Official: [21302469](21302469)
  * 绿仙Official: [21302479](21302479)
  * 本间向日葵Official: [21302477](21302477)
  * 静凛Official: [21302352](21302352)
  * 委员长杂鱼搬运: [278936](278936)
  * 樋口枫的枫树林: [12492310](12492310)
  * 竜胆尊搬运组: [14892076](14892076)
  * 塞塔尼亚已毕业: [31634](31634)
* 赤星共和国連邦Channel: [24276](24276)
* THE MOON STUDIO
  * 輝夜月Official: [7602132](7602132)
  * PPHOfficial: [21402105](21402105)
* Lucca Project
  * 乌拉の帝国Official: [14893](14893)
  * 喀秋莎秋明Official: [2610619](2610619)
  * 萨莎柯里克Official: [21318294](21318294)
* SOW
  * 米莎ミサOfficial: [21361292](21361292)
  * 莲娜多莲佐Official: [21316325](21316325)
  * 凛星Channel: [14507014](14507014)
  * ItaChannel: [27651](27651)
  * 貓野奈木Official: [2289415](2289415)
  * 綾奈なな: [337374](337374)
  * 星ノ谷みやOfficial: [21344122](21344122)
  * Riztech: [58896](58896)
  * 疯狂wink系眠葉紺: [21240069](21240069)
  * 艾麗卡・エリカチャン: [802169](802169)
  * 草履虫Para: [6873375](6873375)
  * 这是一只YY: [10317](10317)
  * 阿德罗伊-埃菲尔德: [801354](801354)
* HoderAstra
  * 矢泽大凤Channel: [21208533](21208533)
  * 金丝蓝染Channel: [4100246](4100246)
  * Plutya普露提亚: [1865305](1865305)
* Chucolala
  * 眞白かのん搬运组: [21402309](21402309)
  * 緋赤エリオ搬运组: [21396545](21396545)
* HoneyStrap
  * 周防パトラ搬运: [15043003](15043003)
  * 西園寺メアリ搬運: [304420](304420)
* Animare 有閑喫茶あにまーれ
  * 宇森ひなこ王国運搬: [11672349](11672349)
  * AnMr海外转播Channel: [13289738](13289738)
* 虚研社
  * 幽灵子辰: [40529](40529)
* 无所属/无细分 (懒)
  * 神楽七奈Official: [21304638](21304638)
  * 清露イクナ搬运组: [21327595](21327595)
  * YuNi\_Channel: [11110277](11110277)
  * 青家大院: [4657471](4657471)
  * 战斗吧歌姬官方账号: [14578426](14578426)
  * 魔宵さきゅOfficial: [1321846](1321846)
  * 物述有栖-爱丽丝搬运: [9680769](9680769)
  * 是子彧吖: [510409](510409)
  * 织田信姬official: [11933197](11933197)
  * 琥珀-虚颜: [4632617](4632617)
  * 8911勘测研究所: [894919](894919)
  * 虚拟次元计划: [4138602](4138602)
  * 兽耳放送: [11631906](11631906)
  * Mendako醤Official: [21195793](21195793)
  * 竹轮喵Official: [21357592](21357592)
  * 乐喵Channel: [284685](284685)
  * 安堂いなり\_official: [21224291](21224291)
  * 柚唧の微光小剧场: [21338753](21338753)
  * 心斎桥オクトOfficial: [3827429](3827429)
  * 李稍牙牙語: [729794](729794)
  * Siva\_小虾鱼\_: [13576775](13576775)
  * 兰若\_Re: [14110147](14110147)
  * 女巫Vivian: [14239687](14239687)
  * 東雲恵Official: [10358807](10358807)
  * 电脑少女siro\_小白: [21307497](21307497)
  * 紙木姐妹Official: [21288388](21288388)
  * 木糖纯和庄不纯: [919919](919919)
  * 摩提\_MoChi: [21116901](21116901)
  * 蒼乃幽姬: [21254047](21254047)
  * RukiRokiChannel: [21346226](21346226)
  * 兰若\_Ruo: [12386041](12386041)
  * Kanna\_康娜Official: [14222920](14222920)
  * 田中姬铃木雏Official: [10209381](10209381)
  * 白道十二宫和巴恰鲁: [21147578](21147578)
  * shugen: [912226](912226)
  * 天神子兔音Official: [13744134](13744134)
  * AZKi\_Official: [21267062](21267062)
  * 涉谷HAL\_official: [21391318](21391318)
  * 音俣るか運搬組: [21317030](21317030)
  * 进击的冰糖: [876396](876396)
  * 陽向ここみOfficial: [566227](566227)
  * 雪城真尋搬運組: [21390586](21390586)
  * 水漠豆腐: [895206](895206)
  * 日月咪玉-官方: [21300316](21300316)
  * 花芽姐妹Official: [15065340](15065340)
  * 淺羽Asaha\_Mino: [7170879](7170879)
  * 竹取かるた搬运组: [21252047](21252047)
  * 星空悠Channel: [11493013](11493013)
  * RiNE\_Channel: [1305231](1305231)
  * 樱美Yuna-Official: [43822](43822)
  * 七濑胡桃menherachan: [11754098](11754098)
